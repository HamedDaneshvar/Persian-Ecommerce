# فروشگاه اینترنتی فارسی


## نحوه پیکربندی و استفاده از پروژه به صورت لوکال

در مرحله اول نیاز به ساخت یک محیط مجازی(virtual env) جهت اجرا پروژه  دارید که می‌توانید با توجه سیستم عامل خود به صورت زیر عمل کنید:

به مسیر پروژه رفته یعنی(```/volumes/app/.```) و ترمینال یا cmd را در آن اجرا کنید و دستور زیر را وارد کنید:

```sh
python -m venv venv
```

حالا باید محیط مجازی که ساختید را فعال کنید

در **Linux/MacOs**

```sh
source venv/bin/activate
```

در **Windows**

```sh
venv/Scripts/activate
```

در مرحله بعد باید وابستگی‌های(dependency) پروژه را نصب کنید

```sh
pip install -r requirements/local.txt
```

## نحوه اجرای پروژه
برای اجرای پروژه می‌توانید از طریق زیر عمل کنید

فایلی به نام *env.* ساخته و مقادیری مانند فایل *env-sample.* در قرار بدهید. نیازی به مشخص کردن مشخصات دیتابیس پستگرس در این حالت *نیست*.

بعد از این مرحله کافیست که تنظیمات اجرایی پروژه برای استفاده لوکال را با توجه به نوع سیستم عامل خود مشخص کنید.

در **Linux/MacOs**

```sh
export DJANGO_SETTINGS_MODULE=config.settings_local
```

در **Windows**

```sh
set DJANGO_SETTINGS_MODULE=config.settings_local
```

در مرحله بعد دستور زیر را جهت ساخت دیتابیس و جداول آن انجام دهید

```sh
python manage.py migrate
```

در این مرحله میتوانید داده های آماده شده نمونه را با دستور زیر به دیتابیس وارد کنید.(این مرحله اختیاری است)

```sh
python manage.py loaddata fixtures/sampledata.json
```

در نهایت دستور زیر را وارد کنید تا پروژه ران شود و از طریق این [Link](http://127.0.0.1:8000) به آن مراجعه کنید


```sh
python manage.py runserver
```

## نحوه پیکربندی و استفاده از پروژه به صورت پروداکشن

## نحوه اجرای پروژه
برای اجرای پروژه می‌توانید از طریق زیر عمل کنید

فایلی به نام *env.* ساخته و مقادیری مانند فایل *env-sample.* در قرار بدهید. حتما مشخصات دیتابیس پستگرس را مشخص نمایید.

بعد از اینکه کار بالا را انجام دادید تنها کاری که لازم است انجام دهید این است که پروژه را با استفاده از docker اجرا کنید که میتوانید با دستور زیر آن را اجرا کنید.

```sh
docker-compose up --build
```

دستور بالا تمامی dependencyهای مورد نیاز پروژه برای محیط پروداکشن را نصب میکند و همچنین داده های آزمایش پیشفرض را نیز به صورت خودکار به دیتابیس پستگرس اضافه میکند. در صورتی که میخواهید این داده ها به صورت خودکار وارد دیتابیس نشوند کافیست دستور زیر را از فایل Dockerfile برای سرویس جنگو به آدرس `app/Dockerfile/.` حذف نمایید.

```sh
python3 manage.py loaddata fixtures/sampledata.json && \
```

## نکات استفاده از mysql به جای postgres
برای استفاده از mysql به جای postgres حتما نیاز است که هنگام مشخص کردن کانفیگ های متصل شدن به دیتابیس، کانفیگ زیر نیز در تنظیمات اضافه شود.
```python
DATABASES = {
    'default': {
        ...
        'OPTIONS': {
            'charset': 'utf8mb4',
            'init_command': "SET collation_connection = utf8mb4_unicode_ci"
        },
    }
}
```
و بعد از اضافه کردن این تنظیمات در صورتی که خواستیم از داده های نمونه که در دایرکتوری fixture وجود دارد استفاده کنیم باید مراحل زیر را نیز طی کنیم تا بتوانیم از خطای MySQLdb.IntegrityError جلوگیری کنیم.

در مرحله اول کافیست بعد از مشخص کردن کانفیگ های بالا عملیات ماگریشن را با دستور زیر انجام دهیم.
```sh
python manage.py migrate
```

و بعد از این کار لازم است بعضی از ردیف های جداول دیتابیس حذف شود تا تداخلی با فایل داده های نمونه پیدا نکند(لازم به ذکر است اگر نمیخواهید از داده های نمونه استفاده کنید نیازی به انجام این مراحل ندارید) دستورهای زیر را در شل mysql وارد کنید و آن را اجرا کنید.

```sql
SET FOREIGN_KEY_CHECKS=0;
delete from auth_permission;
delete from django_content_type;
SET FOREIGN_KEY_CHECKS=1;
```

و در نهایت وقتی این کار را انجام دادید و دستورات بالا را اجرا کردید کافیست دستور loaddata را استفاده کنید و داده های نمونه خود را به دیتابیس mysql وارد کنید.

```sh
python manage.py loaddata 'path/of/your/sample/data.json'
```